#ifndef BPFILTER_H
#define BPFILTER_H

#include <vector>

const int SAMPLEFILTER_TAP_NUM = 128;

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
     -2.06446234e-04,   1.83933901e-04,   3.53870769e-04,   1.79746076e-04,
     -1.91191578e-04,  -4.25174465e-04,  -2.48457782e-04,   3.11232456e-04,
      8.91441060e-04,   1.04687535e-03,   6.31863353e-04,   6.35142402e-19,
     -2.06536164e-04,   4.16821049e-04,   1.60871093e-03,   2.53398734e-03,
      2.43006160e-03,   1.32769937e-03,   1.88724792e-04,   2.06852776e-04,
      1.74817243e-03,   3.84336807e-03,   4.81311488e-03,   3.66844748e-03,
      1.14051431e-03,  -6.77528139e-04,   1.42559361e-18,   2.96635869e-03,
      5.85895268e-03,   5.92685533e-03,   2.44686364e-03,  -2.29599894e-03,
     -4.58372693e-03,  -2.38275547e-03,   2.56177869e-03,   5.69713204e-03,
      3.30018647e-03,  -4.06971026e-03,  -1.14163816e-02,  -1.30841858e-02,
     -7.69055062e-03,   1.16038453e-17,   2.37959464e-03,  -4.67696684e-03,
     -1.76086993e-02,  -2.71203622e-02,  -2.55041341e-02,  -1.37118231e-02,
     -1.92559554e-03,  -2.09473005e-03,  -1.76624460e-02,  -3.89738232e-02,
     -4.93254068e-02,  -3.82995900e-02,  -1.22463063e-02,   7.56844357e-03,
     -6.72167165e-18,  -3.75716352e-02,  -8.16810664e-02,  -9.40589639e-02,
     -4.64969842e-02,   5.68771939e-02,   1.76174216e-01,   2.55665238e-01,
      2.55665238e-01,   1.76174216e-01,   5.68771939e-02,  -4.64969842e-02,
     -9.40589639e-02,  -8.16810664e-02,  -3.75716352e-02,  -6.72167165e-18,
      7.56844357e-03,  -1.22463063e-02,  -3.82995900e-02,  -4.93254068e-02,
     -3.89738232e-02,  -1.76624460e-02,  -2.09473005e-03,  -1.92559554e-03,
     -1.37118231e-02,  -2.55041341e-02,  -2.71203622e-02,  -1.76086993e-02,
     -4.67696684e-03,   2.37959464e-03,   1.16038453e-17,  -7.69055062e-03,
     -1.30841858e-02,  -1.14163816e-02,  -4.06971026e-03,   3.30018647e-03,
      5.69713204e-03,   2.56177869e-03,  -2.38275547e-03,  -4.58372693e-03,
     -2.29599894e-03,   2.44686364e-03,   5.92685533e-03,   5.85895268e-03,
      2.96635869e-03,   1.42559361e-18,  -6.77528139e-03,   1.14051431e-03,
      3.66844748e-03,   4.81311488e-03,   3.84336807e-03,   1.74817243e-03,
      2.06852776e-04,   1.88724792e-04,   1.32769937e-03,   2.43006160e-03,
      2.53398734e-03,   1.60871093e-03,   4.16821049e-04,  -2.06536164e-04,
      6.35142402e-19,   6.31863353e-04,   1.04687535e-03,   8.91441060e-04,
      3.11232456e-04,  -2.48457782e-04,  -4.25174465e-04,  -1.91191578e-04,
      1.79746076e-04,   3.53870769e-04,   1.83933901e-04,  -2.06446234e-04
};

typedef struct {
  double history[SAMPLEFILTER_TAP_NUM];
  unsigned int last_index;
} SampleFilter;

void SampleFilter_init(SampleFilter* f);
void SampleFilter_put(SampleFilter* f, double input);
double SampleFilter_get(SampleFilter* f);

class BPFilter
{
public:
    BPFilter(){ SampleFilter_init(&filter); }
    std::vector<double> get_filtered_signal(std::vector<double>& signal);

private:
    SampleFilter filter;
};


#endif // BPFILTER_H
