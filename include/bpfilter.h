#ifndef BPFILTER_H
#define BPFILTER_H

#include <vector>

const int SAMPLEFILTER_TAP_NUM = 128;

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
    -0.00020644623369305419, 0.00018393390088357767, 0.0003538707690453555, 0.00017974607554777631,
    -0.00019119157826946346, -0.00042517446461260236, -0.00024845778185039996, 0.00031123245565266072,
    0.00089144106033292776, 0.0010468753489982186, 0.00063186335288291861, 6.3514240174583414e-19,
    -0.00020653616386235614, 0.00041682104893388895, 0.0016087109311897702, 0.0025339873365350786,
    0.0024300615998601957, 0.0013276993695384551, 0.00018872479190755532, 0.00020685277649336824,
    0.0017481724331146102, 0.0038433680724120709, 0.0048131148753877123, 0.003668447481762076,
    0.0011405143082665176, -0.00067752813887567457, 1.4255936066220791e-18, 0.0029663586854053146,
    0.0058589526825438458, 0.0059268553291544832, 0.0024468636402361372, -0.002295998943616406,
    -0.0045837269314734641, -0.0023827554746680933, 0.0025617786912833932, 0.0056971320378734697,
    0.0033001864663019698, -0.0040697102619423912, -0.011416381621868322, -0.01308418580301644,
    -0.007690550616577441, 1.160384531671919e-17, 0.0023795946436074474, -0.0046769668422312807,
    -0.017608699258877418, -0.027120362217828792, -0.02550413409743392, -0.013711823096181068,
    -0.0019255955367826344, -0.0020947300538881834, -0.017662445952809178, -0.038973823208618932,
    -0.049325406840347849, -0.038299589978993812, -0.012246306278482555, 0.0075684435741077815,
    -6.7216716456440504e-18, -0.037571635204261426, -0.081681066372127131, -0.094058963858400235,
    -0.0464969842121703, 0.05687719386899065, 0.17617421648072482, 0.2556652382811691, 0.2556652382811691,
    0.17617421648072482, 0.05687719386899065, -0.0464969842121703, -0.094058963858400235, -0.081681066372127131,
    -0.037571635204261426, -6.7216716456440504e-18, 0.0075684435741077815, -0.012246306278482555, -0.038299589978993812,
    -0.049325406840347849, -0.038973823208618932, -0.017662445952809178, -0.0020947300538881834, -0.0019255955367826344,
    -0.013711823096181065, -0.02550413409743392, -0.027120362217828792, -0.017608699258877418, -0.0046769668422312798,
    0.0023795946436074469, 1.1603845316719188e-17, -0.007690550616577441, -0.013084185803016441, -0.011416381621868322,
    -0.0040697102619423912, 0.0033001864663019689, 0.005697132037873468, 0.0025617786912833923, -0.0023827554746680924,
    -0.004583726931473465, -0.002295998943616406, 0.0024468636402361372, 0.0059268553291544823, 0.0058589526825438441,
    0.0029663586854053133, 1.4255936066220785e-18, -0.00067752813887567468, 0.001140514308266518, 0.003668447481762076,
    0.0048131148753877123, 0.0038433680724120709, 0.0017481724331146092, 0.00020685277649336816, 0.00018872479190755521,
    0.0013276993695384551, 0.0024300615998601957, 0.0025339873365350786, 0.0016087109311897702, 0.00041682104893388895,
    -0.00020653616386235598, 6.3514240174583365e-19, 0.00063186335288291915, 0.0010468753489982186, 0.00089144106033292776,
    0.00031123245565266072, -0.00024845778185039996, -0.00042517446461260209, -0.00019119157826946346, 0.00017974607554777631,
    0.00035387076904535577, 0.00018393390088357767, -0.00020644623369305419
};

typedef struct {
  double history[SAMPLEFILTER_TAP_NUM];
  unsigned int last_index;
} SampleFilter;

void SampleFilter_init(SampleFilter* f);
void SampleFilter_put(SampleFilter* f, double input);
double SampleFilter_get(SampleFilter* f);

class BPFilter
{
public:
    BPFilter(){ SampleFilter_init(&filter); }
    std::vector<double> get_filtered_signal(std::vector<double>& signal);

private:
    SampleFilter filter;
};


#endif // BPFILTER_H
