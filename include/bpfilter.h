#ifndef BPFILTER_H
#define BPFILTER_H

#include <vector>

const int SAMPLEFILTER_TAP_NUM = 256;

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
    -1.5429448283496952e-23, -5.1474752600423192e-08, -1.5311047926280509e-07, -2.1725004414468971e-07,
    -1.2001046266646962e-07, 1.4563369943176857e-07, 3.6632855668605537e-07, 2.3499778532559185e-07,
    -3.0649354044546566e-07, -8.1498193150931818e-07, -5.5746727798444588e-07, 8.0291120300652189e-07,
    2.6049448218337414e-06, 3.4223463735333621e-06, 2.2871555654649457e-06, -1.8388470775854682e-20,
    -8.9463295620336423e-07, 1.9564819192262124e-06, 8.1419755051897207e-06, 1.3771039255973437e-05,
    1.4130120637501423e-05, 8.2350803109483754e-06, 1.2453281716761383e-06, 1.4487363450667799e-06,
    1.2968289067773406e-05, 3.0141590868145181e-05, 3.9837417105343135e-05, 3.1993926654365942e-05,
    1.0465453351515261e-05, -6.5319152597895783e-06, 7.9671776446096032e-20, 3.1440334355765734e-05,
    6.4983697393400174e-05, 6.8701842795395882e-05, 2.9604115532198588e-05, -2.8956521458709124e-05,
    -6.0179869286115137e-05, -3.2522387588625519e-05, 3.6300349744492409e-05, 8.3688648686390806e-05,
    5.018099307668873e-05, -6.3954939901027401e-05, -0.00018511130935397328, -0.00021851839478699518,
    -0.00013204769969260357, -6.038296088804879e-19, 4.2923648310980843e-05, -8.6180201712178812e-05,
    -0.00033062420140134852, -0.00051746351460498483, -0.00049301982722540279, -0.00026765088867186009,
    -3.7812707380215665e-05, -4.1207224604695235e-05, -0.00034640988422227889, -0.00075790792156195353,
    -0.00094501031144375472, -0.00071746462658221213, -0.00022228850300705559, 0.00013164824486060987,
    -2.3619664756729479e-18, -0.00057344066106209345, -0.0011301605613854503, -0.0011409684396849994,
    -0.00047014467794867298, 0.00044032858254747313, 0.00087737292499508927, 0.00045514115593001375,
    -0.00048821614233522637, -0.0010829116499118719, -0.00062540395701029497, 0.00076850012158303908,
    0.0021467926835313789, 0.0024482622000422541, 0.0014306286243159663, 1.3894613491007277e-18,
    -0.00043605648058957209, 0.00084890518477647554, 0.0031605923683364809, 0.0048046951786384472,
    0.0044500751699047799, 0.0023504369616121875, 0.00032333390636931963, 0.00034337960415066205,
    0.0028153452812171584, 0.0060124327571927025, 0.0073234455055842503, 0.0054359935025355584,
    0.0016479809873856683, -0.00095580278425612527, 1.965827574523939e-18, 0.0040029864976609828,
    0.0077459557543314997, 0.0076849112542878252, 0.0031147969750559119, -0.0028722626217214404,
    -0.0056404292107703124, -0.0028867170825461331, 0.0030582329625958547, 0.0067072655341767961,
    0.0038346690476014516, -0.0046706536025812343, -0.012950226294791265, -0.014680011444851307,
    -0.0085398636759567107, 1.2760858279189734e-17, 0.0025931306087055598, -0.0050533249137448971,
    -0.018874243257472494, -0.028853288685645229, -0.026945562153822291, -0.014393274887651214,
    -0.0020091872441274747, -0.0021735534103773852, -0.018233471564423998, -0.040045253288307991,
    -0.050464489545049056, -0.03903184395580795, -0.012436773920040115, 0.0076621503229554735,
    -6.7861419483805677e-18, -0.03784113250868526, -0.08209898814993484, -0.094380127037315728,
    -0.046592788384118865, 0.056936874673886105, 0.17624068310886706, 0.25567594907632396,
    0.25567594907632396, 0.17624068310886706, 0.056936874673886105, -0.046592788384118865,
    -0.094380127037315728, -0.08209898814993484, -0.03784113250868526, -6.7861419483805677e-18,
    0.0076621503229554735, -0.012436773920040115, -0.03903184395580795, -0.050464489545049056,
    -0.040045253288307991, -0.018233471564423998, -0.0021735534103773852, -0.0020091872441274747,
    -0.014393274887651214, -0.026945562153822291, -0.028853288685645229, -0.018874243257472494,
    -0.0050533249137448971, 0.0025931306087055598, 1.2760858279189734e-17, -0.0085398636759567107,
    -0.014680011444851307, -0.012950226294791265, -0.0046706536025812343, 0.0038346690476014516,
    0.0067072655341767961, 0.0030582329625958547, -0.0028867170825461331, -0.0056404292107703124,
    -0.0028722626217214404, 0.0031147969750559119, 0.0076849112542878252, 0.0077459557543314997,
    0.0040029864976609828, 1.965827574523939e-18, -0.00095580278425612527, 0.0016479809873856683,
    0.0054359935025355584, 0.0073234455055842503, 0.0060124327571927025, 0.0028153452812171584,
    0.00034337960415066205, 0.00032333390636931963, 0.0023504369616121875, 0.0044500751699047799,
    0.0048046951786384472, 0.0031605923683364809, 0.00084890518477647554, -0.00043605648058957209,
    1.3894613491007277e-18, 0.0014306286243159663, 0.0024482622000422541, 0.0021467926835313789,
    0.00076850012158303908, -0.00062540395701029497, -0.0010829116499118719, -0.00048821614233522637,
    0.00045514115593001375, 0.00087737292499508927, 0.00044032858254747313, -0.00047014467794867298,
    -0.0011409684396849994, -0.0011301605613854503, -0.00057344066106209345, -2.3619664756729479e-18,
    0.00013164824486060987, -0.00022228850300705559, -0.00071746462658221213, -0.00094501031144375472,
    -0.00075790792156195353, -0.00034640988422227889, -4.1207224604695235e-05, -3.7812707380215665e-05,
    -0.00026765088867186009, -0.00049301982722540279, -0.00051746351460498483, -0.00033062420140134852,
    -8.6180201712178812e-05, 4.2923648310980843e-05, -6.038296088804879e-19, -0.00013204769969260357,
    -0.00021851839478699518, -0.00018511130935397328, -6.3954939901027401e-05, 5.018099307668873e-05,
    8.3688648686390806e-05, 3.6300349744492409e-05, -3.2522387588625519e-05, -6.0179869286115137e-05,
    -2.8956521458709124e-05, 2.9604115532198588e-05, 6.8701842795395882e-05, 6.4983697393400174e-05,
    3.1440334355765734e-05, 7.9671776446096032e-20, -6.5319152597895783e-06, 1.0465453351515261e-05,
    3.1993926654365942e-05, 3.9837417105343135e-05, 3.0141590868145181e-05, 1.2968289067773406e-05,
    1.4487363450667799e-06, 1.2453281716761383e-06, 8.2350803109483754e-06, 1.4130120637501423e-05,
    1.3771039255973437e-05, 8.1419755051897207e-06, 1.9564819192262124e-06, -8.9463295620336423e-07,
    -1.8388470775854682e-20, 2.2871555654649457e-06, 3.4223463735333621e-06, 2.6049448218337414e-06,
    8.0291120300652189e-07, -5.5746727798444588e-07, -8.1498193150931818e-07, -3.0649354044546566e-07,
    2.3499778532559185e-07, 3.6632855668605537e-07, 1.4563369943176857e-07, -1.2001046266646962e-07,
    -2.1725004414468971e-07, -1.5311047926280509e-07, -5.1474752600423192e-08, -1.5429448283496952e-23

};

typedef struct {
  double history[SAMPLEFILTER_TAP_NUM];
  unsigned int last_index;
} SampleFilter;

void SampleFilter_init(SampleFilter* f);
void SampleFilter_put(SampleFilter* f, double input);
double SampleFilter_get(SampleFilter* f);

class BPFilter
{
public:
    BPFilter(){ SampleFilter_init(&filter); }
    std::vector<double> get_filtered_signal(std::vector<double>& signal);

private:
    SampleFilter filter;
};


#endif // BPFILTER_H
